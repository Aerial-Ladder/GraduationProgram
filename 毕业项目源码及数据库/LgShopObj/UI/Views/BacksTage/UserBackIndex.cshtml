@using Models;
@{
    List<UserInfo> list = Session["alluserlist"] as List<UserInfo>;
    int pageindex = ViewBag.pageindex ?? 1;
    double count = 1;
}
<style>
    .UserBack_top {
        width: 100%;
        height: 60px;
        font-size: 1.2em;
        line-height: 60px;
        margin: 10px 0px;
    }

    .span_usernum {
        display: inline-block;
        margin-left: 60px;
    }

        .span_usernum:before {
            font-family: Glyphicons;
            content: "\f3a0";
        }

    .div_right {
        float: right;
        width: 300px;
        height: 100%;
        margin-right: 100px;
    }

    .input_select {
        width: 200px;
        height: 40px;
        border-radius: 5px;
        border: 1px solid gray;
    }

    .table {
        text-align: center;
    }

    .tr_content {
        line-height: 40px;
    }

    .user_null {
        width: 100%;
        height: 60px;
        line-height: 60px;
        text-align: center;
        font-size: 2em;
        color: gray;
        margin-top: 40px;
    }

        .user_null:before {
            font-family: Glyphicons;
            content: "\f3ab";
        }

    .user-div {
        width: 100%;
        height: auto;
        min-height: 720px;
    }

    .user_bot {
        width: 100%;
        height: auto;
        background-color: gray;
    }

    .user_ul li {
        width: 100%;
        height: 40px;
        line-height: 40px;
        margin-left: 20px;
        font-size: 1.1em;
    }
</style>
<div class="UserBack_top">
    <span class="span_usernum">
        &nbsp;用户人数(@{
            if (list == null)
            {
                @:0
            }
            else
            {
                @list.Count();
            }
        })
    </span>
    <div class="div_right">
        @using (Ajax.BeginForm("UserBackIndex", "BacksTage", new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "UserIndex", InsertionMode = InsertionMode.Replace }))
        {
            <input type="text" class="input_select" name="text" placeholder="用户名/账号" />
            <input type="submit" class="btn btn-primary" value="查找" />
        }
    </div>
</div>

@{
    if (list != null && list.Count() > 0)
    {
        <div class="user-div">
            <table class="table table-striped table-bordered">
                <thead style="color: white">
                    <tr class="bg-secondary">
                        <th>编号</th>
                        <th>用户头像</th>
                        <th>用户名</th>
                        <th>账号</th>
                        <th>邮箱</th>
                        <th>用户钱包</th>
                        <th>身份证号</th>
                        <th>收货地址</th>
                        <th>操作</th>
                    </tr>
                </thead>
                @{
                    foreach (var item in list)
                    {
                        <tr class="tr_content bg-light">
                            <td>@item.UserID</td>
                            <td><img src="~/Content/Images/@item.UserPhoto" width="40" height="40" /></td>
                            <td>@item.UserName</td>
                            <td>@item.UserAccount</td>
                            <td>@item.UserEmail</td>
                            <td>@string.Format("{0:C}", item.UserWallet)</td>
                            <td>@item.UserCard</td>
                            <td>@item.ReceivingAddress</td>
                            <td>
                                <a href="#" data-toggle="modal" data-target="#UserDesc" data-whatever="@item.UserID" class="btn btn-outline-primary">详情</a>
                                <a href="#" class="btn btn-outline-success">修改</a>
                                <a href="#" class="btn btn-outline-danger">删除</a>
                            </td>
                        </tr>
                    }
                }
            </table>
        </div>
        <div class="user_bot">
            @*分页位置*@
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">

                    @{
                        if (pageindex <= 1)
                        {
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">上一页</a>
                            </li>
                        }
                        else
                        {
                            <li class="page-item">
                                @Ajax.ActionLink("上一页", "UserBackIndex", "BacksTage", new { pageindex = pageindex - 1 }, new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "UserIndex", InsertionMode = InsertionMode.Replace }, new { @class = "page-link" })
                            </li>
                        }
                    }

                    @{
                        if (pageindex != 1 && pageindex != count)
                        {
                            for (int i = pageindex - 1; i < pageindex + 2; i++)
                            {
                                if (i == pageindex)
                                {
                                    <li class="page-item active">
                                        @Ajax.ActionLink(i.ToString(), "UserBackIndex", "BacksTage", new { pageindex = i }, new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "UserIndex", InsertionMode = InsertionMode.Replace }, new { @class = "page-link" })
                                    </li>
                                }
                                else if (i <= count)
                                {
                                    <li class="page-item">
                                        @Ajax.ActionLink(i.ToString(), "UserBackIndex", "BacksTage", new { pageindex = i }, new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "UserIndex", InsertionMode = InsertionMode.Replace }, new { @class = "page-link" })
                                    </li>
                                }
                            }
                        }
                        else if (pageindex == 1)
                        {
                            for (int i = 0; i <= pageindex + 2; i++)
                            {
                                if (i == pageindex)
                                {
                                    <li class="page-item active">
                                        @Ajax.ActionLink(i.ToString(), "UserBackIndex", "BacksTage", new { pageindex = i }, new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "UserIndex", InsertionMode = InsertionMode.Replace }, new { @class = "page-link" })
                                    </li>
                                }
                                else if (i > 0 && i <= count)
                                {
                                    <li class="page-item">
                                        @Ajax.ActionLink(i.ToString(), "UserBackIndex", "BacksTage", new { pageindex = i }, new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "UserIndex", InsertionMode = InsertionMode.Replace }, new { @class = "page-link" })
                                    </li>
                                }
                            }
                        }
                        else
                        {
                            for (int i = pageindex - 2; i <= count; i++)
                            {
                                if (i == count)
                                {
                                    <li class="page-item active">
                                        @Ajax.ActionLink(i.ToString(), "UserBackIndex", "BacksTage", new { pageindex = i }, new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "UserIndex", InsertionMode = InsertionMode.Replace }, new { @class = "page-link" })
                                    </li>
                                }
                                else if (i > 0)
                                {
                                    <li class="page-item">
                                        @Ajax.ActionLink(i.ToString(), "UserBackIndex", "BacksTage", new { pageindex = i }, new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "UserIndex", InsertionMode = InsertionMode.Replace }, new { @class = "page-link" })
                                    </li>
                                }
                            }
                        }
                    }
                    @{
                        if (pageindex == count)
                        {
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">下一页</a>
                            </li>
                        }
                        else
                        {
                            <li class="page-item">
                                @Ajax.ActionLink("下一页", "UserBackIndex", "BacksTage", new { pageindex = pageindex + 1 }, new AjaxOptions { HttpMethod = "Post", UpdateTargetId = "UserIndex", InsertionMode = InsertionMode.Replace }, new { @class = "page-link" })
                            </li>
                        }
                    }
                </ul>
            </nav>
        </div>
    }
    else
    {
        <div class="user_null">&nbsp;暂无用户信息！</div>
    }
}

<!-- 详情模态框 -->
<div class="modal fade" id="UserDesc" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">&nbsp;用户详情</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul class="user_ul">
                    <li>头像:<img src="~/Content/Images/default.jpg" width="40" height="40" style="margin-left:20px;" /></li>
                    <li>用户名:</li>
                    <li>账号:</li>
                    <li>性别:</li>
                    <li>年龄:</li>
                    <li>邮箱:</li>
                    <li>手机号:</li>
                    <li>生日:</li>
                    <li>身份证号:</li>
                    <li>用户钱包:</li>
                    <li>收货地址:</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        //用户信息详情
        $('#UserDesc').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget);
            var userid = button.data('whatever');
            var modal = $(this);
            $.post({
                url: "@Url.Action("UserDesc","BacksTage")",
                data: { UserID: userid },
                success: function (data) {
                    if (data == null) {
                        alert('查看详情失败！');
                    } else {
                        console.log(data);
                        $('.user_ul li:eq(0) img').attr('src', '../Content/Images/' + data.user.UserPhoto + '');
                        $('.user_ul li:eq(1)').html('用户名:&nbsp;&nbsp;' + data.user.UserName + '');
                        $('.user_ul li:eq(2)').html('账号:&nbsp;&nbsp;' + data.user.UserAccount + '');
                        $('.user_ul li:eq(3)').html('性别:&nbsp;&nbsp;' + data.user.UserSex + '');
                        $('.user_ul li:eq(4)').html('年龄:&nbsp;&nbsp;' + data.user.UserAge + '');
                        $('.user_ul li:eq(5)').html('邮箱:&nbsp;&nbsp;' + data.user.UserEmail + '');
                        $('.user_ul li:eq(6)').html('手机号:&nbsp;&nbsp;' + data.user.UserPhont + '');
                        $('.user_ul li:eq(7)').html('生日:&nbsp;&nbsp;' + data.b + '');
                        $('.user_ul li:eq(8)').html('身份证号:&nbsp;&nbsp;' + data.user.UserCard + '');
                        $('.user_ul li:eq(9)').html('用户钱包:&nbsp;&nbsp;' + ToMoney(data.user.UserWallet) + '');
                        $('.user_ul li:eq(10)').html('收货地址:&nbsp;&nbsp;' + data.user.ReceivingAddress + '');
                    }
                },
                error: function () {
                    alert("出现错误！");
                }
            })
        })

         //转化成价格格式
            function ToMoney(s, n) {
                n = n > 0 && n <= 20 ? n : 2;
                s = parseFloat((s + "").replace(/[^\d\.-]/g, "")).toFixed(n) + "";
                var l = s.split(".")[0].split("").reverse(),
                    r = s.split(".")[1];
                t = "";
                for (i = 0; i < l.length; i++) {
                    t += l[i] + ((i + 1) % 3 == 0 && (i + 1) != l.length ? "," : "");
                }
                return "¥"+t.split("").reverse().join("") + "." + r;
            }
    })
</script>

